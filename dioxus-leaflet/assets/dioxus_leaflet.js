async function f(){let t=window.L;while(!t)await h(100),t=window.L;return t}function h(t){return new Promise((e)=>setTimeout(e,t))}var L=new Map,y=new Map,P=new Map;async function g(t){let e=L.get(t);if(!e){let o=P.get(t);if(!o)o=new Promise((r)=>{y.set(t,r)}),P.set(t,o);e=await o}return e}async function b(t,e,o){let r=await f(),n=L.get(t)??r.map(`dioxus-leaflet-map-${t}`,{zoomControl:o.zoom_control,scrollWheelZoom:o.scroll_wheel_zoom,doubleClickZoom:o.double_click_zoom,touchZoom:o.touch_zoom,dragging:o.dragging,keyboard:o.keyboard,attributionControl:o.attribution_control});if(n.setView(e.coordinates,e.zoom),r.tileLayer(o.tile_layer.url,{attribution:o.tile_layer.attribution,maxZoom:o.tile_layer.max_zoom,subdomains:o.tile_layer.subdomains}).addTo(n),L.set(t,n),y.has(t))y.get(t)(n),y.delete(t),P.delete(t);await h(100),n.invalidateSize()}function l(t){L.delete(t)}async function O(t,e){await f();let o=await g(t);if(!o)throw Error(`Map with id ${t} not found when setting onClick handler`);o.on("click",async(r)=>{try{await e([r.latlng.lat,r.latlng.lng])}catch(n){console.error("Error in on_map_click callback:",n)}})}var d=new Map;function x(t){return d.get(t)}async function B(t,e,o,r){let n=await f(),w=await g(t);if(!w)throw Error(`Map with id ${t} not found when updating polygon ${e}`);let u=d.get(e)??n.polygon([]).addTo(w);d.set(e,u),u.setLatLngs(o),u.setStyle(r);let p=I(e);if(p)u.unbindPopup(),u.bindPopup(p.body,p.options)}async function H(t,e){let o=await f();if(!await g(t))throw Error(`Map with id ${t} not found when deleting polygon ${e}`);d.delete(e)}var s=new Map;function I(t){return s.get(t)}async function A(t,e,o){let r=await f(),n=`dioxus-leaflet-popup-${e}`,w=document.getElementById(n);if(!w)throw Error(`Popup body element with id ${n} not found when updating popup for object ${t}`);s.set(t,{body:w,options:o});let u=$(t)??x(t);if(u)u.unbindPopup(),u.bindPopup(w,o)}var c=new Map;function $(t){return c.get(t)}async function N(t,e,o,r){let n=await f(),w=await g(t);if(!w)throw Error(`Map with id ${t} not found when updating marker ${e}`);let u=c.get(e)??n.marker([0,0]).addTo(w);if(c.set(e,u),u.setLatLng(o),r)u.setIcon(n.icon(r));let p=I(e);if(p)u.unbindPopup(),u.bindPopup(p.body,p.options)}async function Q(t,e){let o=await f(),r=await g(t);if(!r)throw Error(`Map with id ${t} not found when deleting marker ${e}`);let n=c.get(e);if(!n)throw Error(`Marker with id ${e} not found when deleting`);r.removeLayer(n),c.delete(e)}export{A as update_popup,B as update_polygon,N as update_marker,b as update_map,O as on_map_click,I as get_popup,x as get_polygon,$ as get_marker,g as get_map,H as delete_polygon,Q as delete_marker,l as delete_map};
