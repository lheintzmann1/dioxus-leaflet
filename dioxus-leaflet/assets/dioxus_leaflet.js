async function setup(){let l=window.L;while(!l)await wait(100),l=window.L;return l}function wait(ms){return new Promise((resolve)=>setTimeout(resolve,ms))}var _maps=new Map,_callbacks=new Map;function get_map(map_id){return _maps.get(map_id)}async function update_map(map_id,initial_position,options){let l=await setup(),map=_maps.get(map_id)??l.map(`dioxus-leaflet-map-${map_id}`,{zoomControl:options.zoom_control,scrollWheelZoom:options.scroll_wheel_zoom,doubleClickZoom:options.double_click_zoom,touchZoom:options.touch_zoom,dragging:options.dragging,keyboard:options.keyboard,attributionControl:options.attribution_control});_maps.set(map_id,map),map.setView(initial_position.coordinates,initial_position.zoom),l.tileLayer(options.tile_layer.url,{attribution:options.tile_layer.attribution,maxZoom:options.tile_layer.max_zoom,subdomains:options.tile_layer.subdomains}).addTo(map),await wait(100),map.invalidateSize()}function delete_map(map_id){_maps.delete(map_id),_callbacks.delete(map_id)}async function on_map_click(map_id,callback){await setup();let map=get_map(map_id);if(!map)throw Error(`Map with id ${map_id} not found when setting onClick handler`);_callbacks.set(map_id,callback),map.on("click",async(e)=>{let cb=_callbacks.get(map_id);if(cb)console.log("js-pre"),await cb([e.latlng.lat,e.latlng.lng]),console.log("js-post")})}var _gons=new Map;function get_polygon(polygon_id){return _gons.get(polygon_id)}async function update_polygon(map_id,polygon_id,coordinates,options){let l=await setup(),map=get_map(map_id);if(!map)throw Error(`Map with id ${map_id} not found when updating polygon ${polygon_id}`);let gon=_gons.get(polygon_id)??l.polygon([]).addTo(map);_gons.set(polygon_id,gon),gon.setLatLngs(coordinates),gon.setStyle(options);let popup=get_popup(polygon_id);if(popup)gon.unbindPopup(),gon.bindPopup(popup.body,popup.options)}async function delete_polygon(map_id,polygon_id){let l=await setup();if(!get_map(map_id))throw Error(`Map with id ${map_id} not found when deleting polygon ${polygon_id}`);_gons.delete(polygon_id)}var _popups=new Map;function get_popup(marker_id){return _popups.get(marker_id)}async function update_popup(marker_id,popup_id,options){let l=await setup(),id=`dioxus-leaflet-popup-${popup_id}`,body=document.getElementById(id);if(!body)throw Error(`Popup body element with id ${id} not found when updating popup for object ${marker_id}`);_popups.set(marker_id,{body,options});let context=get_marker(marker_id)??get_polygon(marker_id);if(context)context.unbindPopup(),context.bindPopup(body,options)}var _markers=new Map;function get_marker(marker_id){return _markers.get(marker_id)}async function update_marker(map_id,marker_id,coordinate,icon){let l=await setup(),map=get_map(map_id);if(!map)throw Error(`Map with id ${map_id} not found when updating marker ${marker_id}`);let marker=_markers.get(marker_id)??l.marker([0,0]).addTo(map);if(_markers.set(marker_id,marker),marker.setLatLng(coordinate),icon)marker.setIcon(l.icon(icon));let popup=get_popup(marker_id);if(popup)marker.unbindPopup(),marker.bindPopup(popup.body,popup.options)}async function delete_marker(map_id,marker_id){let l=await setup(),map=get_map(map_id);if(!map)throw Error(`Map with id ${map_id} not found when deleting marker ${marker_id}`);let marker=_markers.get(marker_id);if(!marker)throw Error(`Marker with id ${marker_id} not found when deleting`);map.removeLayer(marker),_markers.delete(marker_id)}export{update_popup,update_polygon,update_marker,update_map,on_map_click,get_popup,get_polygon,get_marker,get_map,delete_polygon,delete_marker,delete_map};
